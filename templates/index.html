<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <title>Hand Analyzer · Racket Scouter</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <link
      rel="stylesheet"
      href="{{ url_for('static', filename='style.css') }}"
    />
    <script
      src="{{ url_for('static', filename='recommend.js') }}"
      defer
    ></script>
  </head>
  <body>
    <div class="app">
      <header class="app-header">
        <div class="brand">
          <span class="brand-logo">🎾</span>
          <div class="brand-text">
            <h1 class="brand-title">Hand Analyzer</h1>
            <p class="brand-subtitle">
              손 모양 + 설문 기반 테니스 라켓 · 스트링 추천 실험용 UI
            </p>
          </div>
        </div>
        <nav>
          <a href="/admin" class="button button-secondary">DB 관리</a>
        </nav>
      </header>

      <main class="app-main">
        <!-- 1. 손 이미지 분석 -->
        <section class="card upload-card">
          <h2 class="card-title">1. 손 이미지 분석</h2>
          <p class="card-description">
            손바닥 전체가 나오도록 촬영한 이미지를 업로드해 주세요.
          </p>

          <!-- 촬영 거리 (기존 스타일 유지) -->
          <div class="capture-row">
            <div class="survey-field">
              <label for="captureDistanceInput">촬영 거리 (cm)</label>
              <input
                id="captureDistanceInput"
                type="number"
                class="input"
                min="10"
                max="100"
                step="1"
                value="30"
              />
            </div>
          </div>

          <!-- 실제 파일 input (숨김) -->
          <input
            type="file"
            id="handImage"
            accept="image/*"
            class="hidden-input"
          />

          <!-- 2×2 그리드: 
               [파일선택]    [이미지 미리보기 텍스트]
               [드롭존]      [미리보기 박스] -->
          <div class="upload-grid">
            <!-- 1행 왼쪽: 파일 선택 버튼 -->
            <div class="upload-cell file-cell">
              <label
                for="handImage"
                class="button button-secondary file-select-button"
              >
                파일 선택
              </label>
            </div>

            <!-- 1행 오른쪽: 미리보기 텍스트 (버튼과 같은 높이) -->
            <div class="upload-cell preview-title-cell">
              <h3 class="preview-title">이미지 미리보기</h3>
            </div>

            <!-- 2행 왼쪽: 드롭존 -->
            <div class="upload-cell drop-cell">
              <div class="drop-zone" id="dropZone">
                <div class="drop-zone-inner">
                  <span class="drop-icon">📷</span>
                  <p class="drop-text">이미지를 여기로 끌어오세요</p>
                  <p class="drop-hint">
                    또는 위의 ‘파일 선택’ 버튼을 이용하세요. JPG, PNG 등 이미지
                    파일만 지원합니다.
                  </p>
                </div>
              </div>
            </div>

            <!-- 2행 오른쪽: 미리보기 박스 -->
            <div class="upload-cell preview-cell">
              <div class="preview-box">
                <img id="previewImage" alt="손 이미지 미리보기" />
                <span id="previewPlaceholder" class="preview-placeholder">
                  아직 선택된 이미지가 없습니다.
                </span>
              </div>
            </div>
          </div>

          <!-- 손 분석 실행 -->
          <div class="upload-controls">
            <button id="uploadBtn" class="button button-primary">
              손 분석 실행
            </button>
          </div>

          <p id="fileName" class="file-name">선택된 파일이 없습니다.</p>

          <!-- 손 분석 결과 -->
          <div class="result-section upload-metrics">
            <h3 class="section-title">
              손 분석 결과
              <span
                class="help-icon"
                data-tooltip="손 길이 지수·손 너비 지수는 사진에서 측정한 상대 크기 점수입니다. 값이 클수록 손이 큰 편이며, 보통 500~900 사이에 분포합니다. 700 이상 큰 손, 600 전후 평균, 550 이하 작은 손으로 참고할 수 있습니다. 손 길이/너비(mm/cm)는 이 점수를 바탕으로 성인 평균 손 크기를 기준으로 추정한 값입니다. (추측입니다)"
                >?</span
              >
            </h3>
            <div id="handMetrics" class="metrics-grid"></div>
          </div>
        </section>

        <!-- 2. 설문 · 라켓/스트링 추천 -->
        <section class="card result-card">
          <h2 class="card-title">2. 설문 및 라켓 · 스트링 추천</h2>

          <div id="loading" class="loading hidden">
            <div class="spinner"></div>
            <span>요청을 처리 중입니다…</span>
          </div>

          <div id="errorBox" class="alert alert-error hidden"></div>

          <div class="result-section">
            <h3 class="section-title">플레이 스타일 설문</h3>
            <p class="section-hint">
              4개 정도의 항목만 선택해 주면 라켓과 스트링 추천 정확도가 더 좋아집니다.
              선택하지 않은 항목은 기본값으로 계산됩니다.
            </p>

            <form id="surveyForm" class="survey-grid" onsubmit="return false;">
              <div class="survey-field">
                <label for="surveyLevel">현재 레벨 / 구력</label>
                <select id="surveyLevel" class="input">
                  <option value="">선택 안 함</option>
                  <option value="beginner">입문 (레슨 3개월 이하)</option>
                  <option value="intermediate">초급 (3~12개월)</option>
                  <option value="advanced">중급 (1~3년)</option>
                  <option value="expert">상급 (3년 이상)</option>
                </select>
              </div>

              <div class="survey-field">
                <label for="surveyPain">팔·손목 통증 여부</label>
                <select id="surveyPain" class="input">
                  <option value="">선택 안 함</option>
                  <option value="none">통증 없음</option>
                  <option value="sometimes">가끔 있다</option>
                  <option value="often">자주 있다 / 민감하다</option>
                </select>
              </div>

              <div class="survey-field">
                <label for="surveySwing">스윙 속도 / 템포</label>
                <select id="surveySwing" class="input">
                  <option value="">선택 안 함</option>
                  <option value="slow">느린 편</option>
                  <option value="normal">보통</option>
                  <option value="fast">빠른 편</option>
                </select>
              </div>

              <div class="survey-field">
                <label for="surveyStringType">
                  선호 스트링 타입
                  <span
                    class="help-icon"
                    data-tooltip="폴리: 스핀·내구성, 대신 조금 더 단단한 느낌 / 멀티: 부드럽고 팔에 편안하지만 내구성은 약간 떨어질 수 있습니다."
                    >?</span
                  >
                </label>
                <select id="surveyStringType" class="input">
                  <option value="auto">상관 없음</option>
                  <option value="poly">폴리 위주가 좋음</option>
                  <option value="multi">멀티필라멘트 위주가 좋음</option>
                </select>
              </div>

              <div class="survey-field">
                <label>원하는 플레이 스타일 (복수 선택 가능)</label>
                <div class="survey-options">
                  <label class="survey-checkbox">
                    <input type="checkbox" id="stylePower" value="power" />
                    파워 중심
                  </label>
                  <label class="survey-checkbox">
                    <input type="checkbox" id="styleControl" value="control" />
                    컨트롤 중심
                  </label>
                  <label class="survey-checkbox">
                    <input type="checkbox" id="styleSpin" value="spin" />
                    스핀 위주
                  </label>
                </div>
              </div>
            </form>
          </div>

          <div class="result-section">
            <div class="survey-actions">
              <button id="recommendBtn" class="button button-primary">
                라켓·스트링 추천 실행
              </button>
              <p class="section-hint">
                손 분석 결과가 있으면 함께 반영하고, 없으면 설문 정보만으로
                라켓과 스트링(텐션)을 추천합니다.
              </p>
            </div>
          </div>

          <div class="result-section">
            <h3 class="section-title">스트링 · 텐션 추천</h3>
            <p class="section-hint">
              손 분석 결과와 설문 정보를 함께 반영한 종합 추천입니다.
            </p>
            <div id="stringRecommendation" class="string-box">
              <span class="metric-label">아직 추천 결과가 없습니다.</span>
            </div>
          </div>

          <div class="result-section">
            <h3 class="section-title">라켓 추천 결과</h3>
            <p class="section-hint">
              손 분석 결과와 설문을 기반으로 이 서버에서 추천한 라켓 목록입니다.
            </p>
            <div id="racketList" class="racket-list"></div>
          </div>
        </section>
      </main>

      <footer class="app-footer">
        <span>© 2025 Racket Scouter · Hand Analyzer Demo</span>
      </footer>
    </div>
  </body>
</html>
